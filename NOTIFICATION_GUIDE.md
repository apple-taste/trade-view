# 📱 闹铃通知使用指南

## 🔔 三种通知方式

### 1. 🎵 浏览器铃声（内置）

**自动启用，无需配置**

- 价格触及止损/止盈时自动播放JOJO风格音效
- 使用Web Audio API生成三音符旋律
- 可手动上传自定义JOJO音频文件到 `frontend/public/jojo-alert.mp3`

**控制方式：**
- 点击闹铃面板的 🔊 图标开关铃声
- 点击音量百分比调整音量（0-100%）
- 设置会自动保存到浏览器

---

### 2. 🖥️ 桌面通知（系统通知）

**需要手动启用**

#### 如何开启：

1. **在闹铃面板（黄色边框）右上角**
2. **点击"🖥️ 通知"按钮**
3. **浏览器会弹出权限请求**
4. **点击"允许"**

#### 效果：

价格触及止损/止盈时，屏幕右上角会弹出系统通知：

```
🔔 Trade View 价格提醒
600000 - 航天电子
🎉 止盈提醒
当前价格: ¥18.50
```

#### 如何查看：

- **Windows**: 屏幕右下角通知中心
- **macOS**: 屏幕右上角通知中心
- **Chrome**: 通知会停留在屏幕上，需要手动关闭

#### 故障排查：

如果看不到通知，检查：
1. 浏览器通知权限（地址栏左侧锁图标 → 网站设置 → 通知）
2. 系统通知设置（Windows设置 → 通知 / macOS偏好设置 → 通知）
3. 浏览器是否启用了"请勿打扰"模式

---

### 3. 📧 邮件通知

**需要后端配置SMTP服务**

#### 步骤1：配置后端邮件服务

1. **进入后端目录：**
   ```bash
   cd backend
   ```

2. **创建.env文件：**
   ```bash
   cp .env.example .env
   ```

3. **编辑.env文件，填入SMTP配置：**

   **Gmail配置（推荐）：**
   ```bash
   SMTP_SERVER=smtp.gmail.com
   SMTP_PORT=587
   SMTP_USERNAME=your-email@gmail.com
   SMTP_PASSWORD=应用专用密码（16位）
   SENDER_EMAIL=your-email@gmail.com
   SENDER_NAME=Trade View 价格提醒
   ```

   **获取Gmail应用专用密码：**
   - 访问：https://myaccount.google.com/apppasswords
   - 选择应用："邮件"
   - 选择设备："其他" → 输入 "Trade View"
   - 复制生成的16位密码

   **QQ邮箱配置：**
   ```bash
   SMTP_SERVER=smtp.qq.com
   SMTP_PORT=587
   SMTP_USERNAME=your-qq@qq.com
   SMTP_PASSWORD=授权码
   ```

   **获取QQ邮箱授权码：**
   - 登录 QQ邮箱 → 设置 → 账户
   - 开启"IMAP/SMTP服务"
   - 点击"生成授权码"

4. **重启后端服务：**
   ```bash
   python3 main.py
   ```

#### 步骤2：前端开启邮箱提醒

1. **打开用户面板（User Panel）**
2. **找到"📧 邮箱闹铃提醒"开关**
3. **点击切换按钮开启**
4. **点击"📧 发送测试邮件"按钮测试**

#### 步骤3：查看邮件

邮件会发送到您注册时使用的邮箱地址。

**邮件特点：**
- JOJO Land风格HTML模板
- 金色边框（#FFD700）+ 深蓝背景
- 包含股票代码、当前价格、目标价格
- 大号emoji表情

**如果没收到邮件：**
1. 检查垃圾邮件文件夹
2. 检查后端日志：
   ```bash
   cd backend
   # 查看日志中的邮件发送状态
   # ✅ 邮件发送成功 或 ❌ 邮件发送失败
   ```
3. 使用测试邮件功能检测配置
4. 检查.env文件中的配置是否正确

---

## 🎯 完整使用流程

### 设置闹铃：

1. **添加开仓记录时：**
   - 设置止损价格和止盈价格
   - 勾选"止损价格闹铃"和"止盈价格闹铃"

2. **修改现有持仓：**
   - 在开仓历史记录中点击"编辑"
   - 勾选闹铃选项

### 闹铃触发：

当股票价格触及设定的止损/止盈价格时：

1. **🎵 立即播放铃声**（如果已开启）
2. **🖥️ 弹出桌面通知**（如果已授权）
3. **📧 发送邮件通知**（如果已配置并开启）

### 查看通知：

- **浏览器铃声**：立即听到
- **桌面通知**：屏幕右上角/右下角
- **邮件通知**：邮箱收件箱

---

## 🔧 高级配置

### 修改监控频率

编辑 `backend/app/services/alert_monitor.py`：

```python
class AlertMonitor:
    def __init__(self):
        self.check_interval = 10  # 每10秒检查一次（可修改）
```

### 修改价格更新频率

编辑 `backend/app/services/price_monitor.py`：

```python
class PriceMonitor:
    def __init__(self):
        self.update_interval = 5  # 每5秒更新一次价格（可修改）
```

### 自定义JOJO音频

1. 准备MP3文件（3-5秒，<1MB）
2. 放置到：`frontend/public/jojo-alert.mp3`
3. 刷新页面

---

## ⚠️ 常见问题

### Q: 为什么铃声不响？

A: 检查：
1. 闹铃面板显示 🔊（不是🔇）
2. 浏览器音量没有静音
3. 首次访问需要点击页面任意位置激活音频

### Q: 为什么没有桌面通知？

A: 检查：
1. 点击"🖥️ 通知"按钮授权
2. 浏览器通知权限已允许
3. 系统通知没有被禁用

### Q: 为什么没收到邮件？

A: 检查：
1. 后端.env文件已配置
2. 用户面板的邮箱提醒开关已开启
3. 发送测试邮件检测配置
4. 查看后端日志确认发送状态
5. 检查垃圾邮件文件夹

### Q: 邮件发送失败？

A: 可能原因：
1. SMTP配置错误
2. 网络连接问题
3. 邮箱服务商限制（Gmail限制500封/天）
4. 使用了真实密码而非应用专用密码

---

## 📊 通知对比

| 通知方式 | 优点 | 缺点 | 适用场景 |
|---------|------|------|---------|
| 🎵 浏览器铃声 | 即时、无需配置 | 需要页面打开 | 盯盘时实时提醒 |
| 🖥️ 桌面通知 | 系统级、显眼 | 需要授权 | 后台运行时提醒 |
| 📧 邮件通知 | 永久记录、远程接收 | 需要配置、有延迟 | 外出时接收提醒 |

**推荐配置：**
- 三种方式全部开启，确保不错过任何闹铃！

---

## 🎉 快速测试

1. **测试铃声：**
   - 点击闹铃面板的 🔊 图标（如果是🔇则先开启）
   - 手动添加一个测试提醒，会听到JOJO风格音效

2. **测试桌面通知：**
   - 点击"🖥️ 通知"按钮授权
   - 会立即弹出一个测试通知

3. **测试邮件：**
   - 配置后端SMTP后
   - 点击用户面板的"📧 发送测试邮件"
   - 检查邮箱（包括垃圾邮件文件夹）

---

**配置完成后，重启前端和后端服务即可使用！** 🚀
