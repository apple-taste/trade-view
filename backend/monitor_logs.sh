#!/bin/bash

# åç«¯æ—¥å¿—ç›‘æ§è„šæœ¬

LOG_FILE="backend.log"
TAIL_LINES=100

echo "================================================================================
ğŸ“Š åç«¯æ—¥å¿—ç›‘æ§å·¥å…·
================================================================================
"

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$LOG_FILE" ]; then
    echo "âš ï¸  æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: $LOG_FILE"
    echo "ğŸ’¡ æç¤º: ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨å¹¶ç”Ÿæˆæ—¥å¿—æ–‡ä»¶"
    exit 1
fi

# æ˜¾ç¤ºèœå•
echo "è¯·é€‰æ‹©ç›‘æ§æ¨¡å¼ï¼š"
echo ""
echo "1. å®æ—¶ç›‘æ§æ‰€æœ‰æ—¥å¿—"
echo "2. å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—"
echo "3. å®æ—¶ç›‘æ§ChatGPTç›¸å…³æ—¥å¿—"
echo "4. å®æ—¶ç›‘æ§ç¯å¢ƒå˜é‡ç›¸å…³æ—¥å¿—"
echo "5. å®æ—¶ç›‘æ§è¯·æ±‚æ—¥å¿—"
echo "6. æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼ˆæœ€å${TAIL_LINES}è¡Œï¼‰"
echo "7. æŸ¥çœ‹é”™è¯¯ç»Ÿè®¡"
echo "8. é€€å‡º"
echo ""

read -p "è¯·é€‰æ‹© (1-8): " choice

case $choice in
    1)
        echo ""
        echo "ğŸ“Š å®æ—¶ç›‘æ§æ‰€æœ‰æ—¥å¿—..."
        echo "æŒ‰ Ctrl+C åœæ­¢"
        echo "================================================================================
"
        tail -f "$LOG_FILE"
        ;;
    2)
        echo ""
        echo "âŒ å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—..."
        echo "æŒ‰ Ctrl+C åœæ­¢"
        echo "================================================================================
"
        tail -f "$LOG_FILE" | grep -E "(é”™è¯¯|error|Error|ERROR|âŒ|âš ï¸|å¤±è´¥)"
        ;;
    3)
        echo ""
        echo "ğŸ¤– å®æ—¶ç›‘æ§ChatGPTç›¸å…³æ—¥å¿—..."
        echo "æŒ‰ Ctrl+C åœæ­¢"
        echo "================================================================================
"
        tail -f "$LOG_FILE" | grep -E "(ChatGPT|AI|GPT|Token|AI_BUILDER)"
        ;;
    4)
        echo ""
        echo "ğŸ” å®æ—¶ç›‘æ§ç¯å¢ƒå˜é‡ç›¸å…³æ—¥å¿—..."
        echo "æŒ‰ Ctrl+C åœæ­¢"
        echo "================================================================================
"
        tail -f "$LOG_FILE" | grep -E "(ç¯å¢ƒå˜é‡|env|ENV|Token|AI_BUILDER|SMTP)"
        ;;
    5)
        echo ""
        echo "ğŸ“¥ å®æ—¶ç›‘æ§è¯·æ±‚æ—¥å¿—..."
        echo "æŒ‰ Ctrl+C åœæ­¢"
        echo "================================================================================
"
        tail -f "$LOG_FILE" | grep -E "(ğŸ“¥|ğŸ“¤|GET|POST|PUT|DELETE|HTTP)"
        ;;
    6)
        echo ""
        echo "ğŸ“‹ æœ€è¿‘çš„æ—¥å¿—ï¼ˆæœ€å${TAIL_LINES}è¡Œï¼‰..."
        echo "================================================================================
"
        tail -n "$TAIL_LINES" "$LOG_FILE"
        ;;
    7)
        echo ""
        echo "ğŸ“Š é”™è¯¯ç»Ÿè®¡..."
        echo "================================================================================
"
        echo "æ€»é”™è¯¯æ•°: $(grep -cE "(é”™è¯¯|error|Error|ERROR|âŒ)" "$LOG_FILE" 2>/dev/null || echo "0")"
        echo ""
        echo "æœ€è¿‘10ä¸ªé”™è¯¯:"
        grep -E "(é”™è¯¯|error|Error|ERROR|âŒ)" "$LOG_FILE" | tail -n 10
        ;;
    8)
        echo "é€€å‡ºç›‘æ§å·¥å…·"
        exit 0
        ;;
    *)
        echo "æ— æ•ˆé€‰æ‹©"
        exit 1
        ;;
esac
