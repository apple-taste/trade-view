# 快速审查检查表

## ⚡ 5分钟快速检查

### 1. 核心数据流（2分钟）
- [ ] **创建交易** → 日历标记更新 ✓
- [ ] **创建交易** → 持仓列表显示 ✓
- [ ] **止盈/止损** → 持仓移除 ✓
- [ ] **止盈/止损** → 交易历史更新 ✓

### 2. 价格监控（1分钟）
- [ ] 价格自动刷新（每5秒）
- [ ] 价格来源显示（新浪财经/腾讯财经）
- [ ] 闹铃触发检查

### 3. 面板联动（1分钟）
- [ ] TradeContext刷新机制工作正常
- [ ] 各面板监听refresh key变化
- [ ] 操作后正确触发刷新

### 4. 错误处理（1分钟）
- [ ] API错误有提示
- [ ] 网络错误有处理
- [ ] 价格获取失败有降级

---

## 🔍 详细检查点

### 数据流检查
```
用户操作 → API请求 → 数据库更新 → 状态刷新 → UI更新
```

**关键点：**
- [ ] 每个操作都触发了正确的API
- [ ] API返回后更新了正确的状态
- [ ] 状态更新后UI正确刷新

### 状态同步检查
```
创建交易 → status="open" → 出现在持仓列表
止盈/止损 → status="closed" → 从持仓列表移除，保留在交易历史
```

**关键点：**
- [ ] 状态转换正确
- [ ] 数据一致性保持

### 价格更新检查
```
定时器触发 → 批量获取价格 → 更新状态 → 检查闹铃 → UI刷新
```

**关键点：**
- [ ] 价格正确获取
- [ ] 来源正确显示
- [ ] 闹铃正确触发

---

## 🐛 常见问题检查

### 问题1: 日历标记不更新
**检查：**
- [ ] `TradeHistoryPanel` 创建/删除后调用 `refreshCalendar()`
- [ ] `CalendarPanel` 监听 `_calendarRefreshKey`
- [ ] `/api/trades/dates` API返回正确数据

### 问题2: 价格不显示
**检查：**
- [ ] `/api/positions` 返回 `current_price` 和 `price_source`
- [ ] `price_monitor.fetch_stock_price()` 返回正确格式
- [ ] 前端正确解析和显示

### 问题3: 闹铃不触发
**检查：**
- [ ] `stop_loss_alert` 或 `take_profit_alert` 为 `true`
- [ ] `stop_loss_price` 或 `take_profit_price` 已设置
- [ ] `current_price` 达到触发条件
- [ ] `checkAlerts()` 函数被调用

### 问题4: 面板不联动
**检查：**
- [ ] `App.tsx` 中包裹了 `TradeProvider`
- [ ] 各面板使用 `useTrade()` hook
- [ ] 操作后调用刷新函数
- [ ] 面板监听对应的 refresh key

---

## 📊 测试场景

### 场景1: 完整交易流程
```
1. 登录系统
2. 添加交易记录（600879，1000股，15.50元）
3. 检查日历：该日期是否有📈标记
4. 检查持仓：是否出现在持仓列表
5. 设置止损：14.00元，开启提醒
6. 设置止盈：18.00元，开启提醒
7. 等待价格更新（或手动刷新）
8. 检查价格来源是否显示
9. 模拟价格触发止损（修改价格或等待）
10. 执行止损操作
11. 检查持仓：该股票是否移除
12. 检查交易历史：订单结果是否为"止损"
13. 检查AI分析：是否更新
```

### 场景2: 多日期交易
```
1. 在不同日期添加多条交易记录
2. 切换日历日期
3. 检查交易历史面板是否显示对应日期的记录
4. 切换到"全部历史"模式
5. 检查是否显示所有交易记录
```

### 场景3: 价格监控
```
1. 添加持仓
2. 观察价格自动刷新（每5秒）
3. 检查价格来源显示
4. 手动点击刷新按钮
5. 检查价格和来源是否更新
```

---

## ✅ 审查完成标准

### 必须通过
- [x] 创建交易后，日历标记更新
- [x] 创建交易后，持仓列表更新
- [x] 止盈/止损后，持仓移除
- [x] 价格正确显示和刷新
- [x] 价格来源正确显示
- [x] 闹铃状态正确显示

### 应该通过
- [ ] 所有面板联动正常
- [ ] 错误处理完善
- [ ] 用户体验良好
- [ ] 性能表现良好

---

**审查时，请逐项检查并标记完成状态。**
